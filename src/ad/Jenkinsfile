pipeline {
  agent {
    docker {
      image 'eclipse-temurin:21-jdk'
      args "-v ${env.HOME}/.gradle:/root/.gradle:rw"
      reuseNode true
    }
  }

  options {
    timestamps()
    buildDiscarder(logRotator(numToKeepStr: '3'))
  }

  stages {
    stage('Source Code Checkout') {
      steps {
        cleanWs()
        checkout scm

        sh '''
          echo "Commit SHA: $(git rev-parse HEAD)"
          echo "Branch    : $(git rev-parse --abbrev-ref HEAD)"
          echo "Build #   : ${BUILD_NUMBER}"
        '''
      }
    }

    stage('Dependency Restore') {
      steps {
        dir('src/ad') {                
          sh 'chmod +x gradlew'
          sh './gradlew --version --no-daemon'
          sh './gradlew downloadRepos --no-daemon'
        }
      }
    }

    stage('test test') {
      steps {
        echo 'test test test'
      }
    }
  }
}

